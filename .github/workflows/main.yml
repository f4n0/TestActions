name: "test"
on: workflow_dispatch
jobs:
  before:
    runs-on: ubuntu-latest
    steps:
    - name: echo var
      run: echo ${{vars.VERSION}}
  edit:
    runs-on: ubuntu-latest
    needs: before
    steps:
    - name: Increment Variable
      run: |
        echo "NEWVER = $(${{vars.VERSION}} | awk -F. -v OFS=. '{$NF += 1; print}')" >> $GITHUB_ENV
    - name: Edit Variable
      run: |
        curl -L \
        -X PATCH \
        -H "Accept: application/vnd.github+json" \
        -H "Authorization: Bearer ${{ secrets.VARIABLES }}" \
        -H "X-GitHub-Api-Version: 2022-11-28" \
        https://api.github.com/repos/f4n0/TestActions/actions/variables/VERSION \
        -d '{"name":"VERSION","value":"${{ env.NEWVER }}"}'
  post:
    runs-on: ubuntu-latest    
    needs: edit
    steps:
    - name: echo var post
      run: echo ${{vars.VERSION}}
